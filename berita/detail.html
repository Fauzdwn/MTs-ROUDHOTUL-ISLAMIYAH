<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Detail Berita</title>
  <style>
    .card-detail {
      padding: 20px;
      margin: 20px;
    }
    .other-news {
      margin-top: 40px;
    }
    .other-news .card {
      border: 1px solid #ccc;
      padding: 10px;
      margin: 5px;
    }
  </style>
</head>
<body>
  <div id="detail-container"></div>

  <div class="other-news">
    <h3>Berita Lainnya</h3>
    <div id="other-news-container"></div>
  </div>

  <!-- Sertakan Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script>
  // Konfigurasi Firebase (sama dengan di index.html)
  const firebaseConfig = {
    apiKey: "AIzaSyDS4s-wVugqVY9lJMFLjNcVF7g1PeVsavg",
    authDomain: "mtsri-db.firebaseapp.com",
    databaseURL: "https://mtsri-db-default-rtdb.firebaseio.com",
    projectId: "mtsri-db",
    storageBucket: "mtsri-db.firebasestorage.app",
    messagingSenderId: "527113049114",
    appId: "1:527113049114:web:7cef29ff65eb0764c4ada3",
    measurementId: "G-YLLS59VXGQ"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // 1. Ambil idBerita dari URL
  const urlParams = new URLSearchParams(window.location.search);
  const idBerita = urlParams.get('id');  // Misalnya: detail.html?id=308

  const detailContainer = document.getElementById("detail-container");
  const otherNewsContainer = document.getElementById("other-news-container");

  // 2. Cari berita berdasarkan field idBerita
  // Karena struktur database menggunakan key acak, kita gunakan orderByChild untuk mencari
  const beritaRef = db.ref("berita");
  beritaRef.orderByChild("idBerita").equalTo(Number(idBerita)).once("value")
    .then(snapshot => {
      const data = snapshot.val();
      if (data) {
        // Karena hasilnya berupa object dengan satu key, ambil key-nya
        const key = Object.keys(data)[0];
        const berita = data[key];

        // Tampilkan detail berita
        const detailDiv = document.createElement("div");
        detailDiv.className = "card-detail";

        if (berita.banner) {
          const img = document.createElement("img");
          img.src = berita.banner;
          detailDiv.appendChild(img);
        }

        const title = document.createElement("h1");
        title.textContent = berita.titleBerita;
        detailDiv.appendChild(title);

        // Tampilkan isi berita (pastikan properti ini ada di database, misalnya 'isiBerita')
        const contentText = document.createElement("p");
        contentText.textContent = berita.isiBerita;
        detailDiv.appendChild(contentText);

        // Tampilkan informasi lain (misalnya createdAt)
        const createdAt = document.createElement("p");
        createdAt.textContent = "Dibuat pada: " + berita.createdAt;
        detailDiv.appendChild(createdAt);
        // Setelah menampilkan detail berita
if (berita.edit && berita.edit === "iya") {
  const editedLabel = document.createElement("p");
  editedLabel.style.fontStyle = "italic";
  editedLabel.style.fontSize = "0.9em";
  editedLabel.textContent = "diedit";
  detailDiv.appendChild(editedLabel);
}
        // Tampilkan detail berita
detailContainer.appendChild(detailDiv);

// Tambahkan tombol share ke WhatsApp dan tombol salin link
const shareContainer = document.createElement("div");
shareContainer.style.marginTop = "20px";

// Tombol untuk share ke WhatsApp
const waButton = document.createElement("button");
waButton.textContent = "Share ke WhatsApp";
waButton.style.marginRight = "10px";
waButton.addEventListener("click", () => {
  // Menggunakan API WhatsApp untuk share link
  const currentURL = window.location.href;
  const waURL = "https://api.whatsapp.com/send?text=" + encodeURIComponent(currentURL);
  window.open(waURL, "_blank");
});
shareContainer.appendChild(waButton);

// Tombol untuk menyalin link berita
const copyButton = document.createElement("button");
copyButton.textContent = "Salin Link";
copyButton.addEventListener("click", () => {
  const currentURL = window.location.href;
  navigator.clipboard.writeText(currentURL)
    .then(() => {
      alert("Link telah disalin ke clipboard.");
    })
    .catch(err => {
      alert("Gagal menyalin link: " + err);
    });
});
shareContainer.appendChild(copyButton);

// Tambahkan container tombol share ke detailContainer
detailContainer.appendChild(shareContainer);


        // Tampilkan Berita Lainnya (kecuali berita yang sedang ditampilkan)
        showOtherNews(key);
      } else {
        detailContainer.textContent = "Berita tidak ditemukan.";
      }
    });

  // Fungsi untuk menampilkan 3 berita lainnya:
  // 2 berita dengan status 'draft' (terbaru) dan 1 berita dengan status 'aktif' (terbaru)
  function showOtherNews(currentKey) {
  beritaRef.once("value").then(snapshot => {
    const data = snapshot.val();
    let drafts = [];
    let aktif = [];
    
    // Pisahkan berita berdasarkan status, kecuali berita yang sedang ditampilkan
    for (let key in data) {
      if (key === currentKey) continue;
      let berita = data[key];
      berita._key = key;
      if (berita.status === "draft") {
        drafts.push(berita);
      } else if (berita.status === "aktif") {
        aktif.push(berita);
      }
    }

    // Urutkan kedua array berdasarkan createdAt secara descending (berita terbaru di atas)
    drafts.sort((a, b) => (a.createdAt > b.createdAt ? -1 : 1));
    aktif.sort((a, b) => (a.createdAt > b.createdAt ? -1 : 1));

    // Ambil maksimal 2 berita draft
    const selectedDrafts = drafts.slice(0, 2);
    // Hitung berapa berita aktif yang diperlukan agar total yang ditampilkan menjadi 3
    const requiredActive = 3 - selectedDrafts.length;
    const selectedAktif = aktif.slice(0, requiredActive);

    // Gabungkan kedua array tersebut
    const selectedNews = selectedDrafts.concat(selectedAktif);

    // Tampilkan berita lainnya
    otherNewsContainer.innerHTML = "";
    selectedNews.forEach(berita => {
      const card = document.createElement("div");
      card.className = "card";
      
      const title = document.createElement("h4");
      title.textContent = berita.titleBerita;
      card.appendChild(title);
      
      const link = document.createElement("a");
      link.href = `detail.html?id=${berita.idBerita}`;  // Pastikan detail.html tersedia untuk menampilkan detail berita
      link.textContent = "Baca Selengkapnya";
      card.appendChild(link);
      
      otherNewsContainer.appendChild(card);
    });
  });
}

</script>

</body>
</html>
